{"version":3,"sources":["webpack:///D:/uni-app/kangjieschool/main.js","webpack:///D:/uni-app/kangjieschool/pages/update/index.vue?3b1d","webpack:///D:/uni-app/kangjieschool/pages/update/index.vue?3cbd","webpack:///D:/uni-app/kangjieschool/pages/update/index.vue?b2cc","webpack:///D:/uni-app/kangjieschool/pages/update/index.vue?8dd9","webpack:///D:/uni-app/kangjieschool/pages/update/index.vue","webpack:///D:/uni-app/kangjieschool/pages/update/index.vue?2346","webpack:///D:/uni-app/kangjieschool/pages/update/index.vue?07d6"],"names":["createPage","Page","components","data","info","Minfo","Mtip","updateInfo","latest","packgeSize","packgePath","downloadTask","downloadProgress","buttonLoading","installed","startProgress","currentIsLatest","onReady","getLatest","updated","uni","getStorageSync","onShow","haveDownloaded","onUnload","closeTask","showToast","onPullDownRefresh","stopPullDownRefresh","methods","text","title","duration","icon","installPackge","plus","runtime","install","force","setStorage","key","completed","success","res","console","log","match","RegExp","showModal","content","showCancel","complete","restart","confirm","cancel","request","url","method","search","statusCode","response","checkLatest","id","$current","name","number","toFixed","setMinfo","type","abort","createTask","downloadLink","downloadFile","saveFile","tempFilePath","savedFilePath","onProgressUpdate","progress","handleUpdate","os","toLowerCase","androidLink","iosLink","openURL"],"mappings":";;;;;;;;;;kDAAA,wCAAmB;;AAEnB;AACA,6F;AACAA,UAAU,CAACC,cAAD,CAAV,C;;;;;;;;;;;;;ACJA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAkH;AAClH;AACyD;AACL;AACa;;;AAGjE;AAC8K;AAC9K,gBAAgB,iLAAU;AAC1B,EAAE,2EAAM;AACR,EAAE,gFAAM;AACR,EAAE,yFAAe;AACjB;AACA;AACA;AACA;AACA;AACA,EAAE,oFAAU;AACZ;AACA;;AAEA;AACA,IAAI,KAAU,EAAE,YAiBf;AACD;AACe,gF;;;;;;;;;;;;AC1Cf;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;;;;;;;;;;;;;ACAA;AAAA;AAAA;AAAA;AAAA;AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;;;;;;;;;;;;;ACRA;AAAA;AAAA;AAAA;AAAypB,CAAgB,moBAAG,EAAC,C;;;;;;;;;;;;mICA7qB;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEe;AACbC,YAAU,EAAE,EADC;;;AAIbC,MAJa,kBAIN;;AAEL,WAAO;AACLC,UAAI,EAAE,MADD,EACS;AACdC,WAAK,EAAE,IAFF,EAEQ;AACbC,UAAI,EAAE,EAHD,EAGK;AACVC,gBAAU,EAAE,GAJP,EAIY;;AAEjBC,YAAM,EAAE,IANH,EAMS;AACdC,gBAAU,EAAE,IAPP,EAOa;AAClBC,gBAAU,EAAE,IARP,EAQa;AAClBC,kBAAY,EAAE,IATT,EASe;AACpBC,sBAAgB,EAAE,CAVb,EAUgB;;AAErBC,mBAAa,EAAE,KAZV,EAYiB;AACtBC,eAAS,EAAE,KAbN,EAaa;AAClBC,mBAAa,EAAE,KAdV,EAciB;AACtBC,qBAAe,EAAE,IAfZ,CAeiB;AAfjB,KAAP;AAiBD,GAvBY;AAwBbC,SAxBa,qBAwBH;AACR,SAAKC,SAAL;AACA,QAAMC,OAAO,GAAGC,GAAG,CAACC,cAAJ,CAAmB,SAAnB,CAAhB;AACA,QAAIF,OAAO,CAACT,UAAZ,EAAwB;AACtB,WAAKA,UAAL,GAAkBS,OAAO,CAACT,UAA1B;AACD;AACF,GA9BY;AA+Bb;AACAY,QAhCa,oBAgCJ;AACP,QAAI,KAAKR,SAAL,KAAmB,IAAnB,IAA2B,KAAKJ,UAApC,EAAgD;AAC9C,WAAKI,SAAL,GAAiB,KAAjB;AACA,WAAKS,cAAL;AACD;AACF,GArCY;AAsCb;AACAC,UAvCa,sBAuCF;AACP,QAAI,KAAKb,YAAT,EAAuB;AACrB,WAAKc,SAAL;AACA,WAAKC,SAAL,CAAe,OAAf;AACD;AACJ,GA5CY;AA6Cb;AACAC,mBA9Ca,+BA8CO;AAClB,SAAKT,SAAL;AACAE,OAAG,CAACQ,mBAAJ;AACD,GAjDY;AAkDbC,SAAO,EAAE;AACP;AACAH,aAFO,qBAEGI,IAFH,EAES;AACdV,SAAG,CAACM,SAAJ,CAAc;AACZK,aAAK,EAAED,IADK;AAEZE,gBAAQ,EAAE,IAFE;AAGZC,YAAI,EAAE,MAHM,EAAd;;AAKD,KARM;AASPC,iBATO,2BASS;AACd;AACAC,UAAI,CAACC,OAAL,CAAaC,OAAb,CAAqB,KAAK3B,UAA1B,EAAsC,EAAE4B,KAAK,EAAE,IAAT,EAAtC;AACA,WAAKxB,SAAL,GAAiB,IAAjB;AACA;AACAM,SAAG,CAACmB,UAAJ,CAAe;AACbC,WAAG,EAAE,SADQ;AAEbrC,YAAI,EAAE;AACJsC,mBAAS,EAAE,IADP;AAEJ/B,oBAAU,EAAE,KAAKA,UAFb,EAFO;;AAMbgC,eAAO,EAAE,iBAACC,GAAD,EAAS;AAChBC,iBAAO,CAACC,GAAR,CAAY,UAAZ;AACD,SARY,EAAf;;AAUA;AACA,UAAI,KAAKnC,UAAL,CAAgBoC,KAAhB,CAAsBC,MAAM,CAAC,MAAD,CAA5B,CAAJ,EAA2C;AACzC,aAAKjC,SAAL,GAAiB,KAAjB;AACAM,WAAG,CAAC4B,SAAJ,CAAc;AACZjB,eAAK,EAAE,IADK;AAEZkB,iBAAO,EAAE,YAFG;AAGZC,oBAAU,EAAE,KAHA;AAIZC,kBAAQ,EAAE,oBAAM;AACdhB,gBAAI,CAACC,OAAL,CAAagB,OAAb;AACD,WANW,EAAd;;AAQD;AACF,KApCM;AAqCP;AACA7B,kBAtCO,4BAsCU;AACfH,SAAG,CAAC4B,SAAJ,CAAc;AACVjB,aAAK,EAAE,QADG;AAEVkB,eAAO,EAAE,kCAFC;AAGVP,eAAO,EAAE,iBAACC,GAAD,EAAS;AACd,cAAIA,GAAG,CAACU,OAAR,EAAiB;AACf;AACA,iBAAI,CAACnB,aAAL;AACD,WAHD,MAGO,IAAIS,GAAG,CAACW,MAAR,EAAgB;AACrB,iBAAI,CAAC5B,SAAL,CAAe,OAAf;AACD;AACJ,SAVS,EAAd;;AAYD,KAnDM;AAoDP;AACAR,aArDO,uBAqDK;AACV,WAAKd,IAAL,GAAY,MAAZ,CADU,CACS;AACnB,WAAKC,KAAL,GAAa,IAAb,CAFU,CAEQ;AAClB,WAAKE,UAAL,GAAkB,GAAlB,CAHU,CAGY;;AAEtB,WAAKM,aAAL,GAAqB,IAArB;AACA,WAAKL,MAAL,GAAc,IAAd;;AAEAY,SAAG,CAACmC,OAAJ,CAAY;AACVC,WAAG,EAAE,mFADK;AAEVC,cAAM,EAAE,KAFE;AAGVtD,YAAI,EAAE;AACJuD,gBAAM,EAAE,YADJ,EAHI;;AAMVhB,eAAO,EAAE,iBAACC,GAAD,EAAS;AAChB,cAAIA,GAAG,CAACgB,UAAJ,KAAmB,GAAvB,EAA4B;AAC1B,gBAAMC,QAAQ,GAAGjB,GAAG,CAACxC,IAArB;AACA,kBAAI,CAACK,MAAL,GAAcoD,QAAQ,CAACpD,MAAT,CAAgBJ,IAA9B;AACA,kBAAI,CAACS,aAAL,GAAqB,KAArB;AACA,kBAAI,CAACgD,WAAL;AACD;AACF,SAbS,EAAZ;;AAeD,KA5EM;AA6EP;AACAA,eA9EO,yBA8EO;AACZ,UAAI,CAAC,KAAKrD,MAAL,CAAYsD,EAAjB,EAAqB;AACnB,aAAKxD,IAAL,GAAY,SAAZ;AACD,OAFD,MAEO,IAAI,KAAKyD,QAAL,CAAcD,EAAd,IAAoB,KAAKtD,MAAL,CAAYsD,EAApC,EAAwC,CAAE;AAC/C,aAAK9C,eAAL,GAAuB,KAAvB;AACA,aAAKV,IAAL,GAAY,OAAZ;AACA,aAAKF,IAAL,GAAY,KAAKI,MAAL,CAAYwD,IAAZ,GAAmB,GAAnB,GAAyB,KAAKxD,MAAL,CAAYyD,MAAjD,CAH6C,CAGW;AACxD,aAAK1D,UAAL,GAAkB,KAAKC,MAAL,CAAYJ,IAA9B;AACA,aAAKK,UAAL,GAAkB,CAAC,KAAKD,MAAL,CAAYC,UAAZ,GAAyB,OAA1B,EAAmCyD,OAAnC,CAA2C,CAA3C,IAAgD,IAAlE,CAL6C,CAK0B;AACvE,aAAKC,QAAL,CAAc,KAAK3D,MAAL,CAAY4D,IAA1B;AACD,OAPM,MAOA;AACL,aAAK1C,SAAL,CAAe,SAAf;AACA,aAAKV,eAAL,GAAuB,IAAvB;AACA,aAAKV,IAAL,GAAY,QAAZ;AACA,aAAKF,IAAL,GAAY,KAAKI,MAAL,CAAYwD,IAAZ,GAAmB,GAAnB,GAAyB,KAAKxD,MAAL,CAAYyD,MAAjD,CAJK,CAImD;AACxD,aAAK1D,UAAL,GAAkB,KAAKC,MAAL,CAAYJ,IAA9B;AACA,aAAK+D,QAAL,CAAc,KAAK3D,MAAL,CAAY4D,IAA1B;AACD;AACF,KAhGM;AAiGP;AACAD,YAlGO,oBAkGEC,IAlGF,EAkGQ;AACb,cAAQA,IAAR;AACE,aAAK,MAAL;AACE,eAAK/D,KAAL,GAAa,KAAb;AACA;AACF,aAAK,OAAL;AACE,eAAKA,KAAL,GAAa,KAAb;AACA;AACF,aAAK,MAAL;AACE,eAAKA,KAAL,GAAa,KAAb;AACA;AACF,aAAK,IAAL;AACE,eAAKA,KAAL,GAAa,KAAb;AACA;AACF,aAAK,SAAL;AACE,eAAKA,KAAL,GAAa,KAAb;AACA;AACF;AACE,eAAKA,KAAL,GAAa,IAAb,CAjBJ;;AAmBD,KAtHM;AAuHP;AACAoB,aAxHO,uBAwHK;AACV,WAAKd,YAAL,CAAkB0D,KAAlB;AACA,WAAK1D,YAAL,GAAoB,IAApB;AACA,WAAKI,aAAL,GAAqB,KAArB;AACD,KA5HM;AA6HP;AACAuD,cA9HO,sBA8HIC,YA9HJ,EA8HkB;AACvB;AACA,UAAI,KAAK7D,UAAT,EAAqB;AACnB,aAAKa,cAAL;AACD,OAFD,MAEO;AACL,aAAKX,gBAAL,GAAwB,CAAxB;AACA,aAAKG,aAAL,GAAqB,IAArB;AACA;AACA,aAAKJ,YAAL,GAAoBS,GAAG,CAACoD,YAAJ,CAAiB;AACnChB,aAAG,EAAEe,YAD8B;AAEnC7B,iBAAO,EAAE,iBAACC,GAAD,EAAS;AAChB,gBAAIA,GAAG,CAACgB,UAAJ,KAAmB,GAAvB,EAA4B;AAC1B;AACAvC,iBAAG,CAACqD,QAAJ,CAAa;AACXC,4BAAY,EAAE/B,GAAG,CAAC+B,YADP;AAEXhC,uBAAO,EAAE,iBAACC,GAAD,EAAS;AAChB,wBAAI,CAACjC,UAAL,GAAkBiC,GAAG,CAACgC,aAAtB;AACA;AACA,wBAAI,CAACzC,aAAL;AACA;AACA,wBAAI,CAACT,SAAL;AACD,iBARU,EAAb;;AAUD;AACF,WAhBkC,EAAjB,CAApB;;AAkBA;AACA,aAAKd,YAAL,CAAkBiE,gBAAlB,CAAmC,UAACjC,GAAD,EAAS;AAC1C,gBAAI,CAAC/B,gBAAL,GAAwB+B,GAAG,CAACkC,QAA5B;AACD,SAFD;AAGD;AACF,KA7JM;AA8JPC,gBA9JO,0BA8JQ;AACb;AACA,UAAI3C,IAAI,CAAC4C,EAAL,CAAQf,IAAR,CAAagB,WAAb,OAA+B,SAAnC,EAA8C;AAC5C,YAAI,KAAKxE,MAAL,CAAYyE,WAAZ,IAA2B,KAAKzE,MAAL,CAAYyE,WAAZ,KAA4B,GAA3D,EAAgE,CAAE;AAChE;AACA,eAAKX,UAAL,CAAgB,KAAK9D,MAAL,CAAYyE,WAA5B;AACD,SAHD,MAGO;AACL,eAAKvD,SAAL,CAAe,SAAf;AACD;AACF,OAPD,MAOO;AACL,YAAI,KAAKlB,MAAL,CAAY0E,OAAZ,IAAuB,KAAK1E,MAAL,CAAY0E,OAAZ,KAAwB,GAAnD,EAAwD,CAAE;AACtD;AACF,cAAI,KAAK1E,MAAL,CAAY0E,OAAZ,CAAoBpC,KAApB,CAA0BC,MAAM,CAAC,MAAD,CAAhC,CAAJ,EAA+C;AAC7C,iBAAKuB,UAAL,CAAgB,KAAK9D,MAAL,CAAY0E,OAA5B;AACD,WAFD,MAEO;AACL;AACA/C,gBAAI,CAACC,OAAL,CAAa+C,OAAb,CAAqB,KAAK3E,MAAL,CAAY0E,OAAjC;AACD;AACF,SARD,MAQO;AACL,eAAKxD,SAAL,CAAe,YAAf;AACD;AACF;AACF,KApLM,EAlDI,E;;;;;;;;;;;;;ACxCf;AAAA;AAAA;AAAA;AAA+7B,CAAgB,63BAAG,EAAC,C;;;;;;;;;;;ACAn9B,uC","file":"pages/update/index.js","sourcesContent":["import 'uni-pages';import '@dcloudio/uni-stat';\n\nimport Vue from 'vue'\nimport Page from './pages/update/index.vue'\ncreatePage(Page)","import { render, staticRenderFns, recyclableRender, components } from \"./index.vue?vue&type=template&id=65eeb334&\"\nvar renderjs\nimport script from \"./index.vue?vue&type=script&lang=js&\"\nexport * from \"./index.vue?vue&type=script&lang=js&\"\nimport style0 from \"./index.vue?vue&type=style&index=0&lang=css&\"\n\n\n/* normalize component */\nimport normalizer from \"!../../../../360安全浏览器下载/HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/vue-cli-plugin-uni/packages/vue-loader/lib/runtime/componentNormalizer.js\"\nvar component = normalizer(\n  script,\n  render,\n  staticRenderFns,\n  false,\n  null,\n  null,\n  null,\n  false,\n  components,\n  renderjs\n)\n\n/* hot reload */\nif (module.hot) {\n  var api = require(\"D:\\\\360安全浏览器下载\\\\HBuilderX\\\\plugins\\\\uniapp-cli\\\\node_modules\\\\vue-hot-reload-api\\\\dist\\\\index.js\")\n  api.install(require('vue'))\n  if (api.compatible) {\n    module.hot.accept()\n    if (!api.isRecorded('65eeb334')) {\n      api.createRecord('65eeb334', component.options)\n    } else {\n      api.reload('65eeb334', component.options)\n    }\n    module.hot.accept(\"./index.vue?vue&type=template&id=65eeb334&\", function () {\n      api.rerender('65eeb334', {\n        render: render,\n        staticRenderFns: staticRenderFns\n      })\n    })\n  }\n}\ncomponent.options.__file = \"uni-app/kangjieschool/pages/update/index.vue\"\nexport default component.exports","export * from \"-!../../../../360安全浏览器下载/HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/vue-cli-plugin-uni/packages/vue-loader/lib/loaders/templateLoader.js??vue-loader-options!../../../../360安全浏览器下载/HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/vue-cli-plugin-uni/packages/webpack-preprocess-loader/index.js??ref--16-0!../../../../360安全浏览器下载/HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/webpack-uni-mp-loader/lib/template.js!../../../../360安全浏览器下载/HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/vue-cli-plugin-uni/packages/webpack-uni-app-loader/page-meta.js!../../../../360安全浏览器下载/HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/vue-cli-plugin-uni/packages/vue-loader/lib/index.js??vue-loader-options!../../../../360安全浏览器下载/HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/webpack-uni-mp-loader/lib/style.js!./index.vue?vue&type=template&id=65eeb334&\"","var components\nvar render = function() {\n  var _vm = this\n  var _h = _vm.$createElement\n  var _c = _vm._self._c || _h\n}\nvar recyclableRender = false\nvar staticRenderFns = []\nrender._withStripped = true\n\nexport { render, staticRenderFns, recyclableRender, components }","import mod from \"-!../../../../360安全浏览器下载/HBuilderX/plugins/uniapp-cli/node_modules/babel-loader/lib/index.js!../../../../360安全浏览器下载/HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/vue-cli-plugin-uni/packages/webpack-preprocess-loader/index.js??ref--12-1!../../../../360安全浏览器下载/HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/webpack-uni-mp-loader/lib/script.js!../../../../360安全浏览器下载/HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/vue-cli-plugin-uni/packages/vue-loader/lib/index.js??vue-loader-options!../../../../360安全浏览器下载/HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/webpack-uni-mp-loader/lib/style.js!./index.vue?vue&type=script&lang=js&\"; export default mod; export * from \"-!../../../../360安全浏览器下载/HBuilderX/plugins/uniapp-cli/node_modules/babel-loader/lib/index.js!../../../../360安全浏览器下载/HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/vue-cli-plugin-uni/packages/webpack-preprocess-loader/index.js??ref--12-1!../../../../360安全浏览器下载/HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/webpack-uni-mp-loader/lib/script.js!../../../../360安全浏览器下载/HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/vue-cli-plugin-uni/packages/vue-loader/lib/index.js??vue-loader-options!../../../../360安全浏览器下载/HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/webpack-uni-mp-loader/lib/style.js!./index.vue?vue&type=script&lang=js&\"","//\r\n//\r\n//\r\n//\r\n//\r\n//\r\n//\r\n//\r\n//\r\n//\r\n//\r\n//\r\n//\r\n//\r\n//\r\n//\r\n//\r\n//\r\n//\r\n//\r\n//\r\n//\r\n//\r\n//\r\n//\r\n//\r\n//\r\n//\r\n//\r\n//\r\n//\r\n//\r\n//\r\n//\r\n//\r\n//\r\n//\r\n//\r\n//\r\n\r\nexport default {\r\n  components: {\r\n\r\n  },\r\n  data() {\r\n\r\n    return {\r\n      info: '正在加载', // 主标题显示版本号\r\n      Minfo: '未知', // 副标题显示版本类型\r\n      Mtip: '', // 小提示标语\r\n      updateInfo: '无', // 更新摘要\r\n\r\n      latest: null, // 版本信息\r\n      packgeSize: null, // 更新包大小\r\n      packgePath: null, // 更新包的文件地址\r\n      downloadTask: null, // 下载任务\r\n      downloadProgress: 0, // 下载进度\r\n\r\n      buttonLoading: false, // 加载 - 标记\r\n      installed: false, // 是否执行了安装 - 标记\r\n      startProgress: false, // 下载进行 - 标记\r\n      currentIsLatest: true // 当前版本就是最新版本 - 标记\r\n    }\r\n  },\r\n  onReady() {\r\n    this.getLatest()\r\n    const updated = uni.getStorageSync('updated')\r\n    if (updated.packgePath) {\r\n      this.packgePath = updated.packgePath\r\n    }\r\n  },\r\n  // 如果用户下载后没有完成安装，却回到app，则执行这里\r\n  onShow() {\r\n    if (this.installed === true && this.packgePath) {\r\n      this.installed = false\r\n      this.haveDownloaded()\r\n    }\r\n  },\r\n  // 用户关闭页面时检查是否存在下载任务\r\n  onUnload() {\r\n      if (this.downloadTask) {\r\n        this.closeTask()\r\n        this.showToast('更新被取消')\r\n      }\r\n  },\r\n  // 下拉刷新更新\r\n  onPullDownRefresh() {\r\n    this.getLatest()\r\n    uni.stopPullDownRefresh()\r\n  },\r\n  methods: {\r\n    // 封装个Toast方便用\r\n    showToast(text) {\r\n      uni.showToast({\r\n        title: text,\r\n        duration: 3000,\r\n        icon: 'none'\r\n      })\r\n    },\r\n    installPackge() {\r\n      // 安装更新\r\n      plus.runtime.install(this.packgePath, { force: true })\r\n      this.installed = true\r\n      // 保存更新记录到stroage，方便下次启动app时删除安装包\r\n      uni.setStorage({\r\n        key: 'updated',\r\n        data: {\r\n          completed: true,\r\n          packgePath: this.packgePath\r\n        },\r\n        success: (res) => {\r\n          console.log('成功保存更新记录')\r\n        }\r\n      })                  \r\n      // 判断是否为热更新（判断文件名中是否含有.wgt）\r\n      if (this.packgePath.match(RegExp(/.wgt/))) {\r\n        this.installed = false\r\n        uni.showModal({\r\n          title: '提示',\r\n          content: '应用将重启以完成更新',\r\n          showCancel: false,\r\n          complete: () => {\r\n            plus.runtime.restart()\r\n          }\r\n        })\r\n      }\r\n    },\r\n    // 已经下载了更新包但是没有安装\r\n    haveDownloaded() {\r\n      uni.showModal({\r\n          title: '更新尚未完成',\r\n          content: '您已下载更新包，但是还没有完成安装，请问是否要继续安装更新包呢？',\r\n          success: (res) => {\r\n              if (res.confirm) {\r\n                // 安装\r\n                this.installPackge()\r\n              } else if (res.cancel) {\r\n                this.showToast('更新被取消')\r\n              }\r\n          }\r\n      })\r\n    },\r\n    // 取得最新版本及其所有信息\r\n    getLatest() {\r\n      this.info = '正在加载' // 主标题显示版本号\r\n      this.Minfo = '未知'\t// 副标题显示版本类型\r\n      this.updateInfo = '无' // 更新摘要\r\n\r\n      this.buttonLoading = true\r\n      this.latest = null\r\n\r\n      uni.request({\r\n        url: 'https://www.easy-mock.com/mock/5c95e1ac8e241c358386bc16/pure-updater/version/info',\r\n        method: 'GET',\r\n        data: {\r\n          search: 'latestInfo'\r\n        },\r\n        success: (res) => {\r\n          if (res.statusCode === 200) {\r\n            const response = res.data\r\n            this.latest = response.latest.info\r\n            this.buttonLoading = false\r\n            this.checkLatest()\r\n          }\r\n        }\r\n      })\r\n    },\r\n    // 检查版本\r\n    checkLatest() {\r\n      if (!this.latest.id) {\r\n        this.Mtip = '未找到发行版本'\r\n      } else if (this.$current.id != this.latest.id) { // 当前版本与新版本不符（$current在main.js里）\r\n        this.currentIsLatest = false\r\n        this.Mtip = '发现新版本'\r\n        this.info = this.latest.name + ' ' + this.latest.number //名称 版本号\r\n        this.updateInfo = this.latest.info\r\n        this.packgeSize = (this.latest.packgeSize / 1048576).toFixed(2) + 'MB' // 请求取得的packgeSize是字节大小，转换为保留两位小数的MB\r\n        this.setMinfo(this.latest.type)\r\n      } else {\r\n        this.showToast('当前是最新版了')\r\n        this.currentIsLatest = true\r\n        this.Mtip = '当前是最新版'\r\n        this.info = this.latest.name + ' ' + this.latest.number //名称 版本号\r\n        this.updateInfo = this.latest.info\r\n        this.setMinfo(this.latest.type)\r\n      }\r\n    },\r\n    // 根据英文版本类型选择中文版本类型\r\n    setMinfo(type) {\r\n      switch (type) {\r\n        case 'base':\r\n          this.Minfo = '结构版'\r\n          break\r\n        case 'alpha':\r\n          this.Minfo = '内测版'\r\n          break\r\n        case 'beta':\r\n          this.Minfo = '公测版'\r\n          break\r\n        case 'rc':\r\n          this.Minfo = '终测版'\r\n          break\r\n        case 'release':\r\n          this.Minfo = '正式版'\r\n          break\r\n        default:\r\n          this.Minfo = '未知'\r\n      }\r\n    },\r\n    // 关闭下载任务\r\n    closeTask() {\r\n      this.downloadTask.abort()\r\n      this.downloadTask = null\r\n      this.startProgress = false\r\n    },\r\n    // 开始下载任务\r\n    createTask(downloadLink) {\r\n      //判断是否已经存在任务\r\n      if (this.packgePath) {\r\n        this.haveDownloaded()\r\n      } else {\r\n        this.downloadProgress = 0\r\n        this.startProgress = true\r\n        // 创建下载任务对象\r\n        this.downloadTask = uni.downloadFile({\r\n          url: downloadLink,\r\n          success: (res) => {\r\n            if (res.statusCode === 200) {\r\n              // 保存下载的安装包\r\n              uni.saveFile({\r\n                tempFilePath: res.tempFilePath,\r\n                success: (res) => {\r\n                  this.packgePath = res.savedFilePath\r\n                  // 进行安装\r\n                  this.installPackge()\r\n                  // 任务完成，关闭下载任务\r\n                  this.closeTask()\r\n                }\r\n              })\r\n            }\r\n          }\r\n        })\r\n        // 进度条更新\r\n        this.downloadTask.onProgressUpdate((res) => {\r\n          this.downloadProgress = res.progress\r\n        })        \r\n      }\r\n    },\r\n    handleUpdate() {\r\n      // 判断系统类型\r\n      if (plus.os.name.toLowerCase() === 'android') {\r\n        if (this.latest.androidLink && this.latest.androidLink !== '#') { // 我这里默认#也是没有地址，请根据业务自行修改\r\n          // 安卓：创建下载任务\r\n          this.createTask(this.latest.androidLink)\r\n        } else {\r\n          this.showToast('未找到下载地址')\r\n        }\r\n      } else {\r\n        if (this.latest.iosLink && this.latest.iosLink !== '#') { // 我这里默认#也是没有地址，请根据业务自行修改\r\n            // 苹果(A)：进行热更新（如果iosLink是wgt更新包的下载地址）判断文件名中是否含有.wgt\r\n          if (this.latest.iosLink.match(RegExp(/.wgt/))) {\r\n            this.createTask(this.latest.iosLink)\r\n          } else {\r\n            // 苹果(B)：打开商店链接（如果iosLink是苹果商店的地址）\r\n            plus.runtime.openURL(this.latest.iosLink)\r\n          }\r\n        } else {\r\n          this.showToast('未找到ios商店地址')\r\n        }\r\n      }\r\n    }\r\n  }\r\n}\r\n","import mod from \"-!../../../../360安全浏览器下载/HBuilderX/plugins/uniapp-cli/node_modules/mini-css-extract-plugin/dist/loader.js??ref--6-oneOf-1-0!../../../../360安全浏览器下载/HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/vue-cli-plugin-uni/packages/webpack-preprocess-loader/index.js??ref--6-oneOf-1-1!../../../../360安全浏览器下载/HBuilderX/plugins/uniapp-cli/node_modules/css-loader/index.js??ref--6-oneOf-1-2!../../../../360安全浏览器下载/HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/vue-cli-plugin-uni/packages/vue-loader/lib/loaders/stylePostLoader.js!../../../../360安全浏览器下载/HBuilderX/plugins/uniapp-cli/node_modules/postcss-loader/src/index.js??ref--6-oneOf-1-3!../../../../360安全浏览器下载/HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/vue-cli-plugin-uni/packages/vue-loader/lib/index.js??vue-loader-options!../../../../360安全浏览器下载/HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/webpack-uni-mp-loader/lib/style.js!./index.vue?vue&type=style&index=0&lang=css&\"; export default mod; export * from \"-!../../../../360安全浏览器下载/HBuilderX/plugins/uniapp-cli/node_modules/mini-css-extract-plugin/dist/loader.js??ref--6-oneOf-1-0!../../../../360安全浏览器下载/HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/vue-cli-plugin-uni/packages/webpack-preprocess-loader/index.js??ref--6-oneOf-1-1!../../../../360安全浏览器下载/HBuilderX/plugins/uniapp-cli/node_modules/css-loader/index.js??ref--6-oneOf-1-2!../../../../360安全浏览器下载/HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/vue-cli-plugin-uni/packages/vue-loader/lib/loaders/stylePostLoader.js!../../../../360安全浏览器下载/HBuilderX/plugins/uniapp-cli/node_modules/postcss-loader/src/index.js??ref--6-oneOf-1-3!../../../../360安全浏览器下载/HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/vue-cli-plugin-uni/packages/vue-loader/lib/index.js??vue-loader-options!../../../../360安全浏览器下载/HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/webpack-uni-mp-loader/lib/style.js!./index.vue?vue&type=style&index=0&lang=css&\"","// extracted by mini-css-extract-plugin"],"sourceRoot":""}